<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sketch2Chart - 手繪轉換工具</title>
    <!-- 基本樣式 -->
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- CodeMirror 編輯器核心 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
    <!-- CodeMirror 主題 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">
    <!-- CodeMirror 代碼折疊 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/fold/foldgutter.min.css">
    
    <!-- CodeMirror 核心腳本 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
    <!-- XML模式用於SVG編輯 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
    <!-- 代碼折疊插件 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/fold/foldcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/fold/foldgutter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/fold/xml-fold.min.js"></script>
    <!-- 搜尋功能 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/search/search.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/search/searchcursor.min.js"></script>
    <!-- 括號匹配 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/matchbrackets.min.js"></script>
    <!-- 代碼自動完成 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/hint/xml-hint.min.js"></script>
    
    <!-- SVG.js 庫 - 用於SVG縮放與平移 -->
    <script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@3.2.0/dist/svg.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.panzoom.js@2.1.2/dist/svg.panzoom.min.js"></script>
</head>
<body>
    <header>
        <h1>Sketch2Chart</h1>
        <p>將手繪圖轉換為結構化代碼</p>
    </header>

    <main>
        <div class="container">
            <!-- 左側輸入區域 -->
            <section class="input-section">
                <div class="tabs">
                    <button class="tab-btn active" data-target="canvas-container">畫布</button>
                    <button class="tab-btn" data-target="upload-container">上傳圖片</button>
                </div>

                <div class="tab-content" id="canvas-container">
                    <div class="canvas-tools">
                        <button id="pen-tool" class="tool-btn active">✏️ 鉛筆</button>
                        <button id="line-tool" class="tool-btn">📏 直線</button>
                        <button id="rect-tool" class="tool-btn">⬜ 矩形</button>
                        <button id="circle-tool" class="tool-btn">⭕ 圓形</button>
                        <button id="text-tool" class="tool-btn">🔤 文字</button>
                        <button id="eraser-tool" class="tool-btn">🧽 橡皮擦</button>
                        <button id="clear-canvas" class="action-btn">🗑️ 清除</button>
                    </div>
                    <div class="canvas-wrapper">
                        <canvas id="drawing-canvas"></canvas>
                    </div>
                </div>

                <div class="tab-content hidden" id="upload-container">
                    <div class="upload-area">
                        <div class="drop-zone">
                            <span class="drop-zone-prompt">拖放圖片到此處或點擊上傳</span>
                            <input type="file" id="image-upload" class="drop-zone-input" accept="image/*">
                        </div>
                        <div id="preview-container" class="hidden">
                            <h3>預覽圖片</h3>
                            <img id="image-preview" src="" alt="預覽圖片">
                            <button id="clear-image" class="action-btn">移除圖片</button>
                        </div>
                    </div>
                </div>

                <div class="text-description">
                    <h3>文字描述（可選）</h3>
                    <textarea id="text-input" placeholder="請輸入額外的文字描述或修改指示..."></textarea>
                </div>

                <div class="api-container">
                    <div class="api-key-container">
                        <label for="api-key">API金鑰</label>
                        <input type="password" id="api-key" placeholder="請輸入您的API金鑰">
                    </div>
                    <button id="advanced-settings-btn" class="action-btn">⚙️ 進階設定</button>
                </div>

                <div class="actions">
                    <button id="convert-btn" class="primary-btn">轉換為SVG</button>
                </div>
            </section>

            <!-- 右側輸出區域 -->
            <section class="output-section">
                <h3 class="section-title">轉換結果</h3>

                <div class="output-content-wrapper">
                    <!-- 主要輸出內容 -->
                    <div class="main-output">
                        <!-- 預覽區域 -->
                        <div class="preview-container">
                            <h4>預覽</h4>
                            <div id="svg-preview">
                                <div class="placeholder">轉換結果將在此顯示</div>
                                <!-- SVG.js 容器將在此創建 -->
                            </div>
                            <!-- 縮放控制按鈕 -->
                            <div class="zoom-controls">
                                <button class="zoom-btn" id="zoom-in">+</button>
                                <button class="zoom-btn" id="zoom-out">-</button>
                                <button class="zoom-btn" id="zoom-reset">⟲</button>
                            </div>
                        </div>

                        <!-- 代碼編輯區域 -->
                        <div class="code-container">
                            <h4>SVG 程式碼</h4>
                            <div class="code-editor-wrapper">
                                <!-- CodeMirror 編輯器將替換此元素 -->
                                <textarea id="code-editor" spellcheck="false"></textarea>
                            </div>
                        </div>

                        <div class="output-actions">
                            <button id="copy-code-btn" class="action-btn" disabled>複製代碼</button>
                            <button id="download-svg-btn" class="primary-btn" disabled>下載SVG</button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 歷史記錄側邊欄（外側） -->
            <section class="history-sidebar">
                <h4>歷史記錄</h4>
                <div id="history-previews" class="history-previews">
                    <div class="placeholder">尚無歷史記錄</div>
                </div>
            </section>
        </div>
    </main>

    <!-- 進階設定模態視窗 -->
    <div id="advanced-settings-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>進階 API 設定</h2>
                <button id="close-modal-btn" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="api-url">API 端點 URL</label>
                    <input type="text" id="api-url" placeholder="例如: https://api.openai.com/v1/chat/completions">
                    <small>輸入 OpenAI 相容的 API 端點。自架 LLM 或其他兼容服務可在此設定。</small>
                </div>
                
                <div class="form-group">
                    <label for="api-model">模型選擇</label>
                    <select id="api-model">
                        <option value="gpt-4-vision-preview">GPT-4 Vision</option>
                        <option value="gpt-4o">GPT-4o</option>
                        <option value="gpt-4-turbo">GPT-4 Turbo</option>
                        <option value="gpt-4">GPT-4</option>
                        <option value="claude-3-opus-20240229">Claude 3 Opus</option>
                        <option value="claude-3-sonnet-20240229">Claude 3 Sonnet</option>
                        <option value="llama-3-70b-vision">Llama 3 70B Vision</option>
                        <option value="custom">自定義...</option>
                    </select>
                </div>
                
                <div id="custom-model-container" class="form-group hidden">
                    <label for="custom-model">自定義模型名稱</label>
                    <input type="text" id="custom-model" placeholder="輸入自定義模型名稱">
                </div>
                
                <div class="form-group">
                    <label for="temperature">溫度 (Temperature)</label>
                    <div class="range-container">
                        <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.7">
                        <span id="temperature-value">0.7</span>
                    </div>
                    <small>較低的值產生更確定性結果，較高的值產生更多樣化結果</small>
                </div>
                
                <div class="form-group">
                    <label for="max-tokens">最大生成令牌數</label>
                    <input type="number" id="max-tokens" min="1" max="16000" value="4000">
                    <small>限制API回應的最大長度</small>
                </div>
                
                <div class="form-group">
                    <label>進階選項</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="stream-response" checked>
                        <label for="stream-response">啟用串流回應（如果 API 支援）</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="save-settings" checked>
                        <label for="save-settings">保存這些設定</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="reset-defaults-btn" class="action-btn">重設為預設值</button>
                <button id="save-settings-btn" class="primary-btn">保存設定</button>
            </div>
        </div>
    </div>

    <footer>
        <p>Sketch2Chart &copy; 2025 | <a href="https://github.com/eric050828/sketch2chart" target="_blank">GitHub</a></p>
    </footer>

    <script src="js/app.js"></script>
    <script src="js/canvas.js"></script>
</body>
</html> 